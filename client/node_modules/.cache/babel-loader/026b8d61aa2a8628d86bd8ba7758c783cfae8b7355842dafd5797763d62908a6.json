{"ast":null,"code":"// https://github.com/msgpack/msgpack/blob/master/spec.md#timestamp-extension-type\nimport { DecodeError } from \"./DecodeError.mjs\";\nimport { getInt64, setInt64 } from \"./utils/int.mjs\";\nexport const EXT_TIMESTAMP = -1;\nconst TIMESTAMP32_MAX_SEC = 0x100000000 - 1; // 32-bit unsigned int\nconst TIMESTAMP64_MAX_SEC = 0x400000000 - 1; // 34-bit unsigned int\nexport function encodeTimeSpecToTimestamp({\n  sec,\n  nsec\n}) {\n  if (sec >= 0 && nsec >= 0 && sec <= TIMESTAMP64_MAX_SEC) {\n    // Here sec >= 0 && nsec >= 0\n    if (nsec === 0 && sec <= TIMESTAMP32_MAX_SEC) {\n      // timestamp 32 = { sec32 (unsigned) }\n      const rv = new Uint8Array(4);\n      const view = new DataView(rv.buffer);\n      view.setUint32(0, sec);\n      return rv;\n    } else {\n      // timestamp 64 = { nsec30 (unsigned), sec34 (unsigned) }\n      const secHigh = sec / 0x100000000;\n      const secLow = sec & 0xffffffff;\n      const rv = new Uint8Array(8);\n      const view = new DataView(rv.buffer);\n      // nsec30 | secHigh2\n      view.setUint32(0, nsec << 2 | secHigh & 0x3);\n      // secLow32\n      view.setUint32(4, secLow);\n      return rv;\n    }\n  } else {\n    // timestamp 96 = { nsec32 (unsigned), sec64 (signed) }\n    const rv = new Uint8Array(12);\n    const view = new DataView(rv.buffer);\n    view.setUint32(0, nsec);\n    setInt64(view, 4, sec);\n    return rv;\n  }\n}\nexport function encodeDateToTimeSpec(date) {\n  const msec = date.getTime();\n  const sec = Math.floor(msec / 1e3);\n  const nsec = (msec - sec * 1e3) * 1e6;\n  // Normalizes { sec, nsec } to ensure nsec is unsigned.\n  const nsecInSec = Math.floor(nsec / 1e9);\n  return {\n    sec: sec + nsecInSec,\n    nsec: nsec - nsecInSec * 1e9\n  };\n}\nexport function encodeTimestampExtension(object) {\n  if (object instanceof Date) {\n    const timeSpec = encodeDateToTimeSpec(object);\n    return encodeTimeSpecToTimestamp(timeSpec);\n  } else {\n    return null;\n  }\n}\nexport function decodeTimestampToTimeSpec(data) {\n  const view = new DataView(data.buffer, data.byteOffset, data.byteLength);\n  // data may be 32, 64, or 96 bits\n  switch (data.byteLength) {\n    case 4:\n      {\n        // timestamp 32 = { sec32 }\n        const sec = view.getUint32(0);\n        const nsec = 0;\n        return {\n          sec,\n          nsec\n        };\n      }\n    case 8:\n      {\n        // timestamp 64 = { nsec30, sec34 }\n        const nsec30AndSecHigh2 = view.getUint32(0);\n        const secLow32 = view.getUint32(4);\n        const sec = (nsec30AndSecHigh2 & 0x3) * 0x100000000 + secLow32;\n        const nsec = nsec30AndSecHigh2 >>> 2;\n        return {\n          sec,\n          nsec\n        };\n      }\n    case 12:\n      {\n        // timestamp 96 = { nsec32 (unsigned), sec64 (signed) }\n        const sec = getInt64(view, 4);\n        const nsec = view.getUint32(0);\n        return {\n          sec,\n          nsec\n        };\n      }\n    default:\n      throw new DecodeError(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${data.length}`);\n  }\n}\nexport function decodeTimestampExtension(data) {\n  const timeSpec = decodeTimestampToTimeSpec(data);\n  return new Date(timeSpec.sec * 1e3 + timeSpec.nsec / 1e6);\n}\nexport const timestampExtension = {\n  type: EXT_TIMESTAMP,\n  encode: encodeTimestampExtension,\n  decode: decodeTimestampExtension\n};","map":{"version":3,"names":["DecodeError","getInt64","setInt64","EXT_TIMESTAMP","TIMESTAMP32_MAX_SEC","TIMESTAMP64_MAX_SEC","encodeTimeSpecToTimestamp","sec","nsec","rv","Uint8Array","view","DataView","buffer","setUint32","secHigh","secLow","encodeDateToTimeSpec","date","msec","getTime","Math","floor","nsecInSec","encodeTimestampExtension","object","Date","timeSpec","decodeTimestampToTimeSpec","data","byteOffset","byteLength","getUint32","nsec30AndSecHigh2","secLow32","length","decodeTimestampExtension","timestampExtension","type","encode","decode"],"sources":["/Users/pranavsrinivasan/Documents/VSCode/aividgen/client/node_modules/@msgpack/msgpack/src/timestamp.ts"],"sourcesContent":["// https://github.com/msgpack/msgpack/blob/master/spec.md#timestamp-extension-type\nimport { DecodeError } from \"./DecodeError.ts\";\nimport { getInt64, setInt64 } from \"./utils/int.ts\";\n\nexport const EXT_TIMESTAMP = -1;\n\nexport type TimeSpec = {\n  sec: number;\n  nsec: number;\n};\n\nconst TIMESTAMP32_MAX_SEC = 0x100000000 - 1; // 32-bit unsigned int\nconst TIMESTAMP64_MAX_SEC = 0x400000000 - 1; // 34-bit unsigned int\n\nexport function encodeTimeSpecToTimestamp({ sec, nsec }: TimeSpec): Uint8Array {\n  if (sec >= 0 && nsec >= 0 && sec <= TIMESTAMP64_MAX_SEC) {\n    // Here sec >= 0 && nsec >= 0\n    if (nsec === 0 && sec <= TIMESTAMP32_MAX_SEC) {\n      // timestamp 32 = { sec32 (unsigned) }\n      const rv = new Uint8Array(4);\n      const view = new DataView(rv.buffer);\n      view.setUint32(0, sec);\n      return rv;\n    } else {\n      // timestamp 64 = { nsec30 (unsigned), sec34 (unsigned) }\n      const secHigh = sec / 0x100000000;\n      const secLow = sec & 0xffffffff;\n      const rv = new Uint8Array(8);\n      const view = new DataView(rv.buffer);\n      // nsec30 | secHigh2\n      view.setUint32(0, (nsec << 2) | (secHigh & 0x3));\n      // secLow32\n      view.setUint32(4, secLow);\n      return rv;\n    }\n  } else {\n    // timestamp 96 = { nsec32 (unsigned), sec64 (signed) }\n    const rv = new Uint8Array(12);\n    const view = new DataView(rv.buffer);\n    view.setUint32(0, nsec);\n    setInt64(view, 4, sec);\n    return rv;\n  }\n}\n\nexport function encodeDateToTimeSpec(date: Date): TimeSpec {\n  const msec = date.getTime();\n  const sec = Math.floor(msec / 1e3);\n  const nsec = (msec - sec * 1e3) * 1e6;\n\n  // Normalizes { sec, nsec } to ensure nsec is unsigned.\n  const nsecInSec = Math.floor(nsec / 1e9);\n  return {\n    sec: sec + nsecInSec,\n    nsec: nsec - nsecInSec * 1e9,\n  };\n}\n\nexport function encodeTimestampExtension(object: unknown): Uint8Array | null {\n  if (object instanceof Date) {\n    const timeSpec = encodeDateToTimeSpec(object);\n    return encodeTimeSpecToTimestamp(timeSpec);\n  } else {\n    return null;\n  }\n}\n\nexport function decodeTimestampToTimeSpec(data: Uint8Array): TimeSpec {\n  const view = new DataView(data.buffer, data.byteOffset, data.byteLength);\n\n  // data may be 32, 64, or 96 bits\n  switch (data.byteLength) {\n    case 4: {\n      // timestamp 32 = { sec32 }\n      const sec = view.getUint32(0);\n      const nsec = 0;\n      return { sec, nsec };\n    }\n    case 8: {\n      // timestamp 64 = { nsec30, sec34 }\n      const nsec30AndSecHigh2 = view.getUint32(0);\n      const secLow32 = view.getUint32(4);\n      const sec = (nsec30AndSecHigh2 & 0x3) * 0x100000000 + secLow32;\n      const nsec = nsec30AndSecHigh2 >>> 2;\n      return { sec, nsec };\n    }\n    case 12: {\n      // timestamp 96 = { nsec32 (unsigned), sec64 (signed) }\n\n      const sec = getInt64(view, 4);\n      const nsec = view.getUint32(0);\n      return { sec, nsec };\n    }\n    default:\n      throw new DecodeError(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${data.length}`);\n  }\n}\n\nexport function decodeTimestampExtension(data: Uint8Array): Date {\n  const timeSpec = decodeTimestampToTimeSpec(data);\n  return new Date(timeSpec.sec * 1e3 + timeSpec.nsec / 1e6);\n}\n\nexport const timestampExtension = {\n  type: EXT_TIMESTAMP,\n  encode: encodeTimestampExtension,\n  decode: decodeTimestampExtension,\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}